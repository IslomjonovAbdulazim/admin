import{r as m,f as I,j as e,B as f,t as w,o as V,_,s as U,e as ue}from"./index-C2efy-H1.js";import{C as E,a as P,b as O,c as R,d as L,u as je}from"./card-C7FjlU42.js";import{H as pe,S as fe,T as ge,C as Ne,P as be}from"./config-drawer-k-4Ro-99.js";import{T as ve,M as ye}from"./top-nav-b8bDTZzJ.js";import{f as we,u as T,U as W,a as M,b as Ce}from"./use-debounce-DJnK7cyG.js";import{B as A}from"./badge-D2ECJKXf.js";import{U as Y,G as Se,D as Ue,e as De,f as Xe,g as ke,h as Z,i as ee,H as Me,I as ae,J as re,K as te,M as ne,N as le,O as ce,Q as Ae,X as k}from"./sign-out-dialog-C7VDqJG5.js";import{u as H,T as Te,a as Fe,b as ie,c as C,d as Ee,e as S,E as Pe,S as de,f as Oe,F as oe,g,h as N,i as b,j as v,k as y,l as q,L as me}from"./form-BA3A6ChG.js";import{P as Re}from"./phone-d7cTxiEk.js";import{c as z}from"./Combination-e_ExlZZi.js";import{u as he,a as xe,I as D}from"./label-Di6lIgUh.js";import{S as B,a as Q,b as $,c as K,d as p}from"./select-Cb8MxY2o.js";import"./index-DM0Fh7Vv.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],qe=z("coins",Le);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ve=z("shield",Ie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],se=z("user-check",_e);function He({data:s,isLoading:d,onEdit:t,onRefresh:l}){const[c,i]=m.useState(!1),[n,o]=m.useState(null),u=I(),h=H({mutationFn:a=>T.delete(a),onSuccess:()=>{w.success("User deleted successfully"),u.invalidateQueries({queryKey:["users"]}),l(),i(!1),o(null)},onError:a=>{w.error(a.response?.data?.detail||"Failed to delete user")}}),r=a=>{o(a),i(!0)};return d?e.jsxs(E,{children:[e.jsxs(P,{children:[e.jsx(O,{children:"Admins"}),e.jsx(R,{children:"Loading..."})]}),e.jsx(L,{children:e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})})]}):s.length===0?e.jsxs(E,{children:[e.jsxs(P,{children:[e.jsx(O,{children:"Admins"}),e.jsx(R,{children:"No admins found"})]}),e.jsx(L,{children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(Y,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsxs("p",{className:"text-muted-foreground text-center",children:["No admins have been created yet.",e.jsx("br",{}),'Click "Add Admin" to get started.']})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(E,{className:"border-0 shadow-lg bg-gradient-to-br from-card via-card to-card/95",children:[e.jsx(P,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(O,{className:"text-xl font-semibold flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),"Users (",s.length,")"]}),e.jsx(R,{className:"mt-1",children:"Manage teachers and students in your learning center"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:"Active Users"}),e.jsx("div",{className:"text-2xl font-bold text-primary",children:s.filter(a=>a.is_active).length})]})]})}),e.jsx(L,{children:e.jsxs(Te,{children:[e.jsx(Fe,{children:e.jsxs(ie,{children:[e.jsx(C,{children:"User"}),e.jsx(C,{children:"Role"}),e.jsx(C,{children:"Coins"}),e.jsx(C,{children:"Created"}),e.jsx(C,{className:"w-[70px]",children:"Actions"})]})}),e.jsx(Ee,{children:s.map(a=>e.jsx(ze,{user:a,onEdit:t,onDelete:r},a.id))})]})})]}),e.jsx(Se,{open:c,onOpenChange:i,handleConfirm:()=>n&&h.mutate(n.id),title:"Delete Admin",desc:`Are you sure you want to delete ${n?.name}? This action cannot be undone.`,confirmText:"Delete Admin",isLoading:h.isPending,destructive:!0})]})}function ze({user:s,onEdit:d,onDelete:t}){const l=i=>{switch(i){case"admin":return e.jsx(Ve,{className:"h-3 w-3"});case"teacher":return e.jsx(Me,{className:"h-3 w-3"});case"student":return e.jsx(W,{className:"h-3 w-3"});default:return e.jsx(W,{className:"h-3 w-3"})}},c=i=>{switch(i){case"admin":return"default";case"teacher":return"secondary";case"student":return"outline";default:return"outline"}};return e.jsxs(ie,{children:[e.jsx(S,{className:"max-w-[300px]",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/20",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:s.name.split(" ").map(i=>i[0]).join("").toUpperCase()})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium truncate",title:s.name,children:s.name}),e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground",children:[e.jsx(Re,{className:"mr-1 h-3 w-3"}),e.jsx("span",{className:"truncate",children:s.phone})]})]})]})}),e.jsx(S,{children:e.jsxs(A,{variant:c(s.role),className:"gap-1",children:[l(s.role),s.role.charAt(0).toUpperCase()+s.role.slice(1)]})}),e.jsx(S,{children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(qe,{className:"h-3 w-3 text-yellow-600"}),e.jsx("span",{className:"font-medium",children:s.coins.toLocaleString()})]})}),e.jsx(S,{children:e.jsx("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:we(new Date(s.created_at),"MMM dd, yyyy")})}),e.jsx(S,{children:s.role!=="admin"?e.jsxs(Ue,{children:[e.jsx(De,{asChild:!0,children:e.jsxs(f,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(Pe,{className:"h-4 w-4"})]})}),e.jsxs(Xe,{align:"end",children:[e.jsx(ke,{children:"Actions"}),e.jsx(Z,{}),e.jsxs(ee,{onClick:()=>d(s),children:[e.jsx(de,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(Z,{}),e.jsxs(ee,{onClick:()=>t(s),className:"text-red-600",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]}):e.jsx("div",{className:"text-xs text-muted-foreground",children:"Protected"})})]},s.id)}const Be=V({name:U().min(2,"Name must be at least 2 characters").max(100,"Name must be less than 100 characters"),phone:U().min(13,"Phone number must be in format +998XXXXXXXXX").regex(/^\+998\d{9}$/,"Please enter a valid Uzbek phone number (+998XXXXXXXXX)"),role:_(["teacher","student"],{message:"Please select a role (admins can only create teachers and students)"})}),Qe=V({name:U().min(2,"Name must be at least 2 characters").max(100,"Name must be less than 100 characters"),phone:U().min(13,"Phone number must be in format +998XXXXXXXXX").regex(/^\+998\d{9}$/,"Please enter a valid Uzbek phone number (+998XXXXXXXXX)"),role:_(["teacher","student"],{message:"Cannot change role to admin"})});V({role:_(["all","admin","teacher","student"]).default("all"),search:U().optional()});function $e({open:s,onOpenChange:d,onSuccess:t}){const[l,c]=m.useState(!1),i=I(),n=he({resolver:xe(Be),defaultValues:{name:"",phone:"",role:"student"}}),o=H({mutationFn:r=>T.create(r),onSuccess:()=>{w.success("User created successfully"),i.invalidateQueries({queryKey:["users"]}),n.reset(),t()},onError:r=>{w.error(r.response?.data?.detail||"Failed to create user")},onSettled:()=>{c(!1)}}),u=async r=>{c(!0),o.mutate(r)},h=r=>{l||(d(r),r||n.reset())};return e.jsx(ae,{open:s,onOpenChange:h,children:e.jsxs(re,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/20",children:e.jsx(M,{className:"h-5 w-5 text-primary"})}),"Create New User"]}),e.jsx(le,{children:"Add a new teacher or student to your learning center."})]}),e.jsx(oe,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(u),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx(g,{control:n.control,name:"name",render:({field:r})=>e.jsxs(N,{children:[e.jsx(b,{children:"Full Name"}),e.jsx(v,{children:e.jsx(D,{placeholder:"Enter full name",...r,disabled:l})}),e.jsx(y,{})]})}),e.jsx(g,{control:n.control,name:"phone",render:({field:r})=>e.jsxs(N,{children:[e.jsx(b,{children:"Phone Number"}),e.jsx(v,{children:e.jsx(D,{placeholder:"+998901234567",...r,disabled:l})}),e.jsx(q,{children:"Enter phone number with country code (e.g., +998901234567)"}),e.jsx(y,{})]})}),e.jsx(g,{control:n.control,name:"role",render:({field:r})=>e.jsxs(N,{children:[e.jsx(b,{children:"Role"}),e.jsxs(B,{onValueChange:r.onChange,value:r.value,disabled:l,children:[e.jsx(v,{children:e.jsx(Q,{children:e.jsx($,{placeholder:"Select a role"})})}),e.jsxs(K,{children:[e.jsx(p,{value:"teacher",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-blue-100",children:e.jsx(M,{className:"h-3 w-3 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Teacher"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manage classes and students"})]})]})}),e.jsx(p,{value:"student",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-green-100",children:e.jsx(M,{className:"h-3 w-3 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Student"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Access learning materials"})]})]})})]})]}),e.jsx(y,{})]})})]}),e.jsxs(ce,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>h(!1),disabled:l,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:l,className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80",children:[l&&e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Create User"]})]})]})})]})})}function Ke({open:s,onOpenChange:d,user:t,onSuccess:l}){const[c,i]=m.useState(!1),n=I(),o=he({resolver:xe(Qe),defaultValues:{name:t.name,phone:t.phone,role:t.role}});m.useEffect(()=>{t&&o.reset({name:t.name,phone:t.phone,role:t.role})},[t,o]);const u=H({mutationFn:a=>T.update(t.id,a),onSuccess:()=>{w.success("User updated successfully"),n.invalidateQueries({queryKey:["users"]}),l()},onError:a=>{w.error(a.response?.data?.detail||"Failed to update user")},onSettled:()=>{i(!1)}}),h=async a=>{i(!0),u.mutate(a)},r=a=>{c||d(a)};return e.jsx(ae,{open:s,onOpenChange:r,children:e.jsxs(re,{className:"sm:max-w-[500px]",children:[e.jsxs(te,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/20",children:e.jsx(de,{className:"h-5 w-5 text-primary"})}),"Edit User"]}),e.jsx(le,{children:"Update user information. Changes will be applied immediately."})]}),e.jsx(oe,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(h),className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsx("div",{className:"rounded-lg bg-muted/50 p-3",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-r from-primary/20 to-primary/10 border border-primary/20",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:t.name.split(" ").map(a=>a[0]).join("").toUpperCase()})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:t.phone})]}),e.jsx(A,{className:"ml-auto",children:t.role.charAt(0).toUpperCase()+t.role.slice(1)})]})}),e.jsx(g,{control:o.control,name:"name",render:({field:a})=>e.jsxs(N,{children:[e.jsx(b,{children:"Full Name"}),e.jsx(v,{children:e.jsx(D,{placeholder:"Enter full name",...a,disabled:c})}),e.jsx(y,{})]})}),e.jsx(g,{control:o.control,name:"phone",render:({field:a})=>e.jsxs(N,{children:[e.jsx(b,{children:"Phone Number"}),e.jsx(v,{children:e.jsx(D,{placeholder:"+998901234567",...a,disabled:c})}),e.jsx(q,{children:"Enter phone number with country code (e.g., +998901234567)"}),e.jsx(y,{})]})}),e.jsx(g,{control:o.control,name:"role",render:({field:a})=>e.jsxs(N,{children:[e.jsx(b,{children:"Role"}),e.jsxs(B,{onValueChange:a.onChange,value:a.value,disabled:c,children:[e.jsx(v,{children:e.jsx(Q,{children:e.jsx($,{placeholder:"Select a role"})})}),e.jsxs(K,{children:[e.jsx(p,{value:"teacher",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-blue-100",children:e.jsx(se,{className:"h-3 w-3 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Teacher"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manage classes and students"})]})]})}),e.jsx(p,{value:"student",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-green-100",children:e.jsx(se,{className:"h-3 w-3 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Student"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Access learning materials"})]})]})})]})]}),e.jsx(q,{children:"Role can be changed between teacher and student only"}),e.jsx(y,{})]})})]}),e.jsxs(ce,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>r(!1),disabled:c,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:c,className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80",children:[c&&e.jsx(me,{className:"mr-2 h-4 w-4 animate-spin"}),"Update User"]})]})]})})]})})}function Ge({filters:s,onFiltersChange:d,className:t}){const[l,c]=m.useState(s.search||""),i=Ce(l,300);m.useEffect(()=>{i!==s.search&&d({...s,search:i||void 0})},[i,s.search]);const n=x=>{c(x)},o=x=>{d({...s,role:x==="all"?void 0:x})},u=()=>{c(""),d({search:void 0,role:void 0})},h=()=>{c(""),d({...s,search:void 0})},r=()=>{d({...s,role:void 0})},a=s.search||s.role,F=x=>{switch(x){case"admin":return"Admin";case"teacher":return"Teacher";case"student":return"Student";default:return x}};return e.jsxs("div",{className:ue("flex flex-col gap-3 p-4 rounded-lg bg-muted/30 border",t),children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(D,{placeholder:"Search by name or phone...",value:l,onChange:x=>n(x.target.value),className:"pl-10 pr-10 h-9"}),l&&e.jsx(f,{variant:"ghost",size:"sm",onClick:h,className:"absolute right-1 top-1/2 h-6 w-6 -translate-y-1/2 p-0 text-muted-foreground",children:e.jsx(k,{className:"h-3 w-3"})})]}),e.jsxs(B,{value:s.role||"all",onValueChange:o,children:[e.jsx(Q,{className:"w-full sm:w-32 h-9",children:e.jsx($,{})}),e.jsxs(K,{children:[e.jsx(p,{value:"all",children:"All Roles"}),e.jsx(p,{value:"admin",children:"Admin"}),e.jsx(p,{value:"teacher",children:"Teacher"}),e.jsx(p,{value:"student",children:"Student"})]})]}),a&&e.jsx(f,{variant:"ghost",size:"sm",onClick:u,className:"h-9",children:e.jsx(k,{className:"h-4 w-4"})})]}),a&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[s.search&&e.jsxs(A,{variant:"outline",className:"text-xs",children:['"',s.search,'"',e.jsx(k,{className:"ml-1 h-3 w-3 cursor-pointer",onClick:h})]}),s.role&&e.jsxs(A,{variant:"outline",className:"text-xs",children:[F(s.role),e.jsx(k,{className:"ml-1 h-3 w-3 cursor-pointer",onClick:r})]})]})]})}function Je(){const[s,d]=m.useState(!1),[t,l]=m.useState(!1),[c,i]=m.useState(null),[n,o]=m.useState({}),{data:u=[],isLoading:h,refetch:r}=je({queryKey:["users"],queryFn:()=>T.list({limit:100})}),a=m.useMemo(()=>{let j=u;if(n.search){const X=n.search.toLowerCase();j=j.filter(J=>J.name.toLowerCase().includes(X)||J.phone.toLowerCase().includes(X))}return n.role&&(j=j.filter(X=>X.role===n.role)),j},[u,n]),F=m.useCallback(j=>{o(j)},[]),x=j=>{i(j),l(!0)},G=()=>{r(),d(!1),l(!1),i(null)};return e.jsxs(e.Fragment,{children:[e.jsxs(pe,{children:[e.jsx(ve,{links:We}),e.jsxs("div",{className:"ms-auto flex items-center space-x-4",children:[e.jsx(fe,{}),e.jsx(ge,{}),e.jsx(Ne,{}),e.jsx(be,{})]})]}),e.jsxs(ye,{children:[e.jsxs("div",{className:"mb-6 flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent",children:"Users"}),e.jsx("p",{className:"text-muted-foreground text-lg",children:"Create and manage teachers and students in your learning center"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(f,{onClick:()=>d(!0),size:"lg",className:"bg-gradient-to-r from-primary to-primary/90 hover:from-primary/90 hover:to-primary/80 shadow-lg hover:shadow-xl transition-all duration-200",children:[e.jsx(M,{className:"mr-2 h-5 w-5"}),"Add User"]})})]}),e.jsx(Ge,{filters:n,onFiltersChange:F,className:"mb-6"}),e.jsx(He,{data:a,isLoading:h,onEdit:x,onRefresh:r})]}),e.jsx($e,{open:s,onOpenChange:d,onSuccess:G}),c&&e.jsx(Ke,{open:t,onOpenChange:l,user:c,onSuccess:G})]})}const We=[{title:"Overview",href:"/user-management",isActive:!0,disabled:!1},{title:"Roles & Permissions",href:"/user-management/roles",isActive:!1,disabled:!0},{title:"Activity Log",href:"/user-management/activity",isActive:!1,disabled:!0}],ms=Je;export{ms as component};
